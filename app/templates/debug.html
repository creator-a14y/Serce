<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serce Admin</title>
    <style>
        body { margin:0; font-family: sans-serif; display: flex; height: 100vh; background: #eee; }
        .split { display: flex; width: 100%; }
        .test-side { flex: 1; background: white; border-right: 1px solid #ccc; display: flex; flex-direction: column; }
        .teach-side { flex: 1; background: #2c3e50; color: white; padding: 20px; }
        #chat-container { flex:1; overflow-y:auto; padding: 20px; display:flex; flex-direction:column; gap:10px; }
        .msg { padding: 10px; border-radius: 10px; max-width: 80%; }
        .user { align-self: flex-end; background: #0084ff; color: white; }
        .bot { align-self: flex-start; background: #f1f1f1; color: black; }
        input, textarea { width: 100%; padding: 10px; margin-bottom: 10px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: #f39c12; border: none; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div class="split">
        <div class="test-side">
            <h4 style="text-align:center; background:#ddd; margin:0; padding:10px;">CANLI TEST</h4>
            <div id="chat-container"></div>
            <div style="padding:10px; border-top:1px solid #ccc;">
                <input type="text" id="ti" placeholder="Buradan test et..." onkeypress="if(event.key=='Enter') test()">
            </div>
        </div>
        <div class="teach-side">
            <h3> Veri Enjeksiyonu</h3>
            <input type="text" id="u" placeholder="Kullan覺c覺">
            <input type="password" id="p" placeholder="ifre">
            <hr>
            <input type="text" id="t" placeholder="retilecek Soru">
            <textarea id="r" rows="4" placeholder="Botun Yan覺t覺"></textarea>
            <button onclick="save()">S襤STEME KAYDET</button>
            <p id="st" style="text-align:center;"></p>
        </div>
    </div>

    <script>
        async function test(){
            const i=document.getElementById('ti'), c=document.getElementById('chat-container');
            if(!i.value) return;
            c.innerHTML+=`<div class="msg user">${i.value}</div>`;
            const r=await fetch(`/get?msg=${encodeURIComponent(i.value)}&mode=debug`);
            const d=await r.json();
            c.innerHTML+=`<div class="msg bot"><b>Sistem:</b> ${d.response}</div>`;
            i.value=''; c.scrollTop=c.scrollHeight;
        }
        async function save(){
            const s=document.getElementById('st'), d={user:document.getElementById('u').value,password:document.getElementById('p').value,tag:document.getElementById('t').value,response:document.getElementById('r').value};
            s.innerText="G繹nderiliyor...";
            const r=await fetch('/teach_debug',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(d)});
            const res=await r.json();
            s.innerText=res.message;
            s.style.color=r.ok?"#2ecc71":"#e74c3c";
        }
    </script>
</body>
</html>
